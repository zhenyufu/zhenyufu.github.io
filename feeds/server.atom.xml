<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom"><title>csmojo</title><link href="http://csmojo.com/" rel="alternate"></link><link href="http://csmojo.com/feeds/server.atom.xml" rel="self"></link><id>http://csmojo.com/</id><updated>2015-07-31T20:16:23-07:00</updated><entry><title>How to set up Debian server with nginx, php5 and MySQL in VM VirtualBox</title><link href="http://csmojo.com/posts/how-to-set-up-debian-server-with-nginx-php5-and-mysql-in-vm-virtualbox.html" rel="alternate"></link><published>2015-07-31T20:16:23-07:00</published><author><name>David</name></author><id>tag:csmojo.com,2015-07-31:posts/how-to-set-up-debian-server-with-nginx-php5-and-mysql-in-vm-virtualbox.html</id><summary type="html">&lt;p&gt;Set up a Server in your VirtualBox in a few simple steps so you can fire it up whenever you need it, 
or simply use it as a playground for your VPS. A Nginx server is small, efficient, and easy to use.&lt;br/&gt;
&lt;img alt="Alt Text" src="http://csmojo.com/images/img20150033.png" style="width: 590px; height: auto; max-width: 100%;"/&gt;&lt;/p&gt;
&lt;h3&gt;Software&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://www.virtualbox.org/wiki/Downloads"&gt;VirtualBox 4.3.28&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://www.debian.org/distrib/"&gt;Debian 8.1.0 amd64&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://nginx.org/"&gt;Nginx 1.6.2&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://php.net/"&gt;PHP 5.6.9&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://www.mysql.com/"&gt;Mysql-server 5.5.44&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;Prerequisites&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;0.1 &lt;a href="http://csmojo.com/posts/how-to-minimally-install-debian-8-in-vm-virtualbox.html"&gt;How to minimally install Debian 8 in VM VirtualBox&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;0.2 Set VM to Bridged Adapter: &lt;a href="http://csmojo.com/posts/how-to-choose-vm-virtualbox-networking.html"&gt;How to choose VM VirtualBox networking&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;1. Install Nginx&lt;/h3&gt;
&lt;p&gt;update package list&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;apt-get update
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;install Nginx&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;apt-get install nginx
&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;2. Check ip address&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;ifconfig
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;For the purpose of this example, we are using Bridged Adapter in VM VirtualBox and 192.168.0.16 as the server address
Your Debian virtual machine is mostly on DHCP, and the IP might change.&lt;/p&gt;
&lt;h3&gt;3. Test Nginx&lt;/h3&gt;
&lt;p&gt;3.1. On your host machine or any other computer within the same network, go to 192.168.0.16 and the Nginx welcome page should show up:&lt;br/&gt;
&lt;img alt="Alt Text" src="http://csmojo.com/images/img20150022.png" style="width: 892px; height: auto; max-width: 100%;"/&gt;&lt;/p&gt;
&lt;p&gt;3.2. Back to the Debian server, go to the default root folder of the Nginx server /var/www/html, 
and use nano to open the "index.nginx-debian.html" file. This is the html of the welcome page in 3.1. &lt;br/&gt;
&lt;img alt="Alt Text" src="http://csmojo.com/images/img20150023.png" style="width: 775px; height: auto; max-width: 100%;"/&gt;&lt;/p&gt;
&lt;p&gt;3.3. Here we edit it by adding a "Hello World!"; back in the browser, the change would have registered
&lt;img alt="Alt Text" src="http://csmojo.com/images/img20150024.png" style="width: 1041px; height: auto; max-width: 100%;"/&gt;&lt;br/&gt;
&lt;img alt="Alt Text" src="http://csmojo.com/images/img20150025.png" style="width: 896px; height: auto; max-width: 100%;"/&gt;&lt;/p&gt;
&lt;p&gt;Up to here, you have yourself a functional Nginx server displaying html pages.&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Intall and configure php
4.1. run:&lt;/li&gt;
&lt;/ol&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;apt-get install php5-fpm
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;4.2. Configure security - change "cgi.fix_pathinfo"&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;nano /etc/php5/fpm/php.ini
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;and change "cgi.fix_pathinfo=1" to "cgi.fix_pathinfo=0"
The above is more of the "conservative" method. Discussion on this matter is old: &lt;a href="http://cnedelcu.blogspot.com/2010/05/nginx-php-via-fastcgi-important.html"&gt;Nginx &amp;amp; PHP via FastCGI important security issue&lt;/a&gt;
Nginx wiki's alternative: &lt;a href="http://wiki.nginx.org/PHPFcgiExample"&gt;FastCGI Example&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;4.3. Configure Nginx to use php&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;nano /etc/nginx/sites-available/default
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;and add "index.php" to the list&lt;br/&gt;
&lt;img alt="Alt Text" src="http://csmojo.com/images/img20150026.png" style="width: 829px; height: auto; max-width: 100%;"/&gt;&lt;/p&gt;
&lt;p&gt;also uncomment  the "location ~ .php{}" function to use  Unix sockets&lt;br/&gt;
&lt;img alt="Alt Text" src="http://csmojo.com/images/img20150027.png" style="width: 936px; height: auto; max-width: 100%;"/&gt;&lt;/p&gt;
&lt;p&gt;Some tutorials suggest editing the following file to enable sockets, but the above is sufficient&lt;br/&gt;
&lt;img alt="Alt Text" src="http://csmojo.com/images/img20150028.png" style="width: 390px; height: auto; max-width: 100%;"/&gt;&lt;/p&gt;
&lt;h3&gt;5. Test php&lt;/h3&gt;
&lt;p&gt;5.1. In the server's root directory, remove "index.nginx-debian.html" and create "index.php" with the following:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="cp"&gt;&amp;lt;?php&lt;/span&gt;
  &lt;span class="nb"&gt;phpinfo&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;
&lt;span class="cp"&gt;?&amp;gt;&lt;/span&gt;&lt;span class="x"&gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;5.2. Restart nginx and php&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;service php5-fpm restart
&lt;/pre&gt;&lt;/div&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;service nginx restart
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;5.3. Again go to 192.168.0.16 in your browser to see the following page:&lt;br/&gt;
&lt;img alt="Alt Text" src="http://csmojo.com/images/img20150029.png" style="width: 962px; height: auto; max-width: 100%;"/&gt;&lt;/p&gt;
&lt;p&gt;Your Nginx server now can show php and html pages.&lt;/p&gt;
&lt;h3&gt;6. Install and config MySQL&lt;/h3&gt;
&lt;p&gt;6.1. Install MySQL
the server:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;apt-get install mysql-server
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;the php5-mysql package:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;apt-get install php5-mysql
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;6.2. Run initialization&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;mysql_install_db
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;6.3. Run Security improvement script&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;mysql_secure_installation
&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;7. Test everything at once&lt;/h3&gt;
&lt;p&gt;modify "index.php" as follows:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="cp"&gt;&amp;lt;?php&lt;/span&gt;
&lt;span class="nv"&gt;$servername&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;"localhost"&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="nv"&gt;$username&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;"root"&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="nv"&gt;$password&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;"yourpassword"&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

&lt;span class="c1"&gt;//new connection&lt;/span&gt;
&lt;span class="nv"&gt;$conn&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;mysqli_connect&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;$servername&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nv"&gt;$username&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nv"&gt;$password&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;

&lt;span class="c1"&gt;//check connection&lt;/span&gt;
&lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;!&lt;/span&gt;&lt;span class="nv"&gt;$conn&lt;/span&gt;&lt;span class="p"&gt;){&lt;/span&gt;
  &lt;span class="k"&gt;die&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;"connection failed: "&lt;/span&gt; &lt;span class="o"&gt;.&lt;/span&gt; &lt;span class="nv"&gt;$conn&lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="na"&gt;connect_error&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="k"&gt;echo&lt;/span&gt; &lt;span class="s2"&gt;"connection ok"&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

&lt;span class="c1"&gt;//php info&lt;/span&gt;
&lt;span class="nb"&gt;phpinfo&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;
&lt;span class="cp"&gt;?&amp;gt;&lt;/span&gt;&lt;span class="x"&gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Use "mysqli_" as "mysql_" functions are deprecated.
This will test the connection with the MySQL server, and show "connection ok" if connected successfully:&lt;br/&gt;
&lt;img alt="Alt Text" src="http://csmojo.com/images/img20150032.png" style="width: 1829px; height: auto; max-width: 100%;"/&gt;&lt;/p&gt;</summary><category term="Debian"></category><category term="Linux"></category><category term="Linux Command"></category><category term="MySQL"></category><category term="Network"></category><category term="Nginx"></category><category term="PHP"></category><category term="Server"></category><category term="VirtualBox"></category></entry></feed>